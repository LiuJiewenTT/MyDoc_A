# ssh跳板机实践1

我使用我的物理机和两台虚拟机进行操作。所有的详见【[ssh基本用法1](ssh基本用法1.md)】。



在`192.168.138.204`:

``` sh
ssh -R 10022:localhost:22 usr1@192.168.138.202
```

然后物理机登入到`192.168.138.202`:

``` sh
ssh usr1@192.168.138.202
```

然后再输入:

``` sh
ssh user1@localhost -p 10022
```

这样就完成了。



整个思路就是*204*登入到*202*，物理机也登入到*202*，然后在*202*本地连进*204*。如果在*204*输入`exit`并不会马上退出，因为物理机通过*202*登入到了*204*，*202*退出*204*才会退出。都退出后，再用特定端口连接就没用了。

如果我想直接从物理机连接到*204*，那么除了上面*204*反向端口转发，还要物理机正向端口转发。

``` mermaid
graph LR
PM[物理机]
202[虚拟机202]
204[虚拟机204]
PM-->202
204-->202
```

在物理机：

``` sh
ssh -L 20022:localhost:10022 usr1@192.168.138.202
```

然后在物理机这样连接：

``` sh
ssh user1@localhost -p 20022
```

所以转发端口相当好用。如果我只能连进跳板机，那么我也可以从本地机一路正向转发。

物理机：

``` sh
ssh -NL 10022:localhost:10022 usr1@192.168.138.202
```

然后打开新*cmd*，登入*202*(跳板机)：

``` sh
ssh usr1@192.168.138.202
```

然后在*202*输入：

``` sh
ssh -NL 10022:localhost:22 user1@192.168.138.204
```

这就完成了，现在在物理机这样就可以连进*204*了：

``` sh
ssh user1@localhost -p 10022
```

``` mermaid
graph LR
PM[物理机]
202[虚拟机202]
204[虚拟机204]
PM-->202
202-->204
```

都明白了吧？

其实上面这个还有种更简单的实现：

直接在物理机上输入:

``` sh
ssh -NL 10022:192.168.138.204:22 usr1@192.168.138.202
```

然后还是同样的命令就可以访问*204*了:

``` sh
ssh user1@localhost -p 10022
```

``` mermaid
graph LR
PM[物理机]
204[虚拟机204]
PM-->|虚拟机202|204
```

现在理解更深一步了吧？